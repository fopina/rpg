<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="0x6BAA OpenVPN Made Easy"><meta itemprop=description content="Why Some people decide to buy some external VPN service for privacy.
Personally, as I already commit all my internet usage to my ISP at home, I rather VPN from untrusted locations into my home instead, saving a few bucks and keeping my ISP as the sole entity holding that information.
I guess I could try to use one of those VPN services (with better privacy terms than my ISP) at home but that would increase complexity too much for the rest of the household"><meta itemprop=datePublished content="2019-12-15T18:54:23+00:00"><meta itemprop=dateModified content="2019-12-17T14:19:57+00:00"><meta itemprop=wordCount content="529"><meta itemprop=keywords content="vpn,raspberrypi,docker,"><meta property="og:title" content="0x6BAA OpenVPN Made Easy"><meta property="og:description" content="Why Some people decide to buy some external VPN service for privacy.
Personally, as I already commit all my internet usage to my ISP at home, I rather VPN from untrusted locations into my home instead, saving a few bucks and keeping my ISP as the sole entity holding that information.
I guess I could try to use one of those VPN services (with better privacy terms than my ISP) at home but that would increase complexity too much for the rest of the household"><meta property="og:type" content="article"><meta property="og:url" content="https://rpg.skmobi.com/posts/0x6baa_openvpn/"><meta property="article:published_time" content="2019-12-15T18:54:23+00:00"><meta property="article:modified_time" content="2019-12-17T14:19:57+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="0x6BAA OpenVPN Made Easy"><meta name=twitter:description content="Why Some people decide to buy some external VPN service for privacy.
Personally, as I already commit all my internet usage to my ISP at home, I rather VPN from untrusted locations into my home instead, saving a few bucks and keeping my ISP as the sole entity holding that information.
I guess I could try to use one of those VPN services (with better privacy terms than my ISP) at home but that would increase complexity too much for the rest of the household"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>0x6BAA OpenVPN Made Easy</title><link rel=stylesheet href=https://rpg.skmobi.com/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://rpg.skmobi.com>Random Post Generator</a></div><nav class="site-nav hide-in-mobile"><a href=https://rpg.skmobi.com/posts/>Posts</a>
<a href=https://rpg.skmobi.com/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/skboy target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://github.com/fopina target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://rpg.skmobi.com/posts/>Posts</a></li><li><a href=https://rpg.skmobi.com/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Dec 15, 2019</span></div><h1>0x6BAA OpenVPN Made Easy</h1></header><div class=content><h2 id=why>Why<a href=#why class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Some people decide to buy some external VPN service for privacy.<br>Personally, as I already commit all my internet usage to my ISP at home, I rather VPN from <em>untrusted locations</em> into my home instead, saving a few bucks and keeping my ISP as the sole entity holding that information.<br>I guess I could try to use one of those VPN services (with better privacy terms than my ISP) at home but that would increase complexity too much for the rest of the <em>household</em></p><p>As I already had some <a href=https://www.raspberrypi.org/>raspberries</a>, <a href=https://github.com/fopina/docker-openvpn/>forking</a> <a href=https://github.com/kylemanna/docker-openvpn/>kylemanna/docker-openvpn</a> to build it for <strong>arm</strong> was the quickest way, some years ago.</p><p>Recently, some people have asked how to use the same docker image quickly in their raspberries, so I took the opportunity to refresh the docker image and add some goodies and I&rsquo;ll summarize the quickstart here.</p><h2 id=how>How<a href=#how class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ol><li>Install <a href=https://www.raspberrypi.org/documentation/installation/installing-images/README.md>raspbian</a> on your Pi (or any other language that supports docker)</li><li>Install <a href=https://docs.docker.com/v17.09/engine/installation/linux/docker-ce/debian/>Docker CE</a></li><li>Run this docker</li></ol><p>First 2 steps are well documented already, let&rsquo;s focus on the third.</p><p>Setting it up in less than 3min</p><p><a href=https://asciinema.org/a/2vyMJDZ76nTQQz3uvIxNyWoCF><img src=https://asciinema.org/a/2vyMJDZ76nTQQz3uvIxNyWoCF.svg alt=asciicast></a></p><h3 id=drill-down>Drill down<a href=#drill-down class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ol><li><p>Initialize the configuration directory</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run --rm <span class=se>\
</span><span class=se></span>        -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>        fopina/openvpn <span class=se>\
</span><span class=se></span>        ovpn_genconfig -u udp://my.external.ip:9999
</code></pre></div><p><code>testvpn</code> used like this will be a <a href=https://docs.docker.com/storage/volumes/>named volume</a> which is probably the cleanest and easiest option for most cases.<br>If you want to make configuration files available to the host filesystem or if you&rsquo;re using this in a <a href=https://docs.docker.com/engine/swarm/>swarm</a>, then you don&rsquo;t use a named volume&mldr;<br><code>udp://my.external.ip:9999</code> can be <code>tcp://</code> instead if you need to use TCP for some reason, but <a href=http://sites.inka.de/bigred/devel/tcp-tcp.html>avoid if possible</a>.<br><code>9999</code> will be port exposed publicly (in your router, for instance), not the one published by the container - might be the same but not necessarily.</p></li><li><p>Generate CA</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run --rm -ti <span class=se>\
</span><span class=se></span>           -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>           fopina/openvpn <span class=se>\
</span><span class=se></span>           ovpn_initpki
</code></pre></div><p>Nothing much to say, just pick a passphrase for the CA that will be used to issue client certificates.</p></li><li><p>Start the service</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>           -d -p 9999:1194/udp <span class=se>\
</span><span class=se></span>           --restart<span class=o>=</span>always <span class=se>\
</span><span class=se></span>           --cap-add<span class=o>=</span>NET_ADMIN <span class=se>\
</span><span class=se></span>           fopina/openvpn
</code></pre></div><p><code>-p 9999:1194/udp</code></p><ul><li>you can choose other published port instead of <code>9999</code></li><li>Leave the internal port <code>1194</code> as that one never changes</li><li>Adjust <code>udp</code> to <code>tcp</code> if you used TCP in the first step</li></ul></li><li><p>Generate client configuration</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run --rm -ti <span class=se>\
</span><span class=se></span>           -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>           fopina/openvpn <span class=se>\
</span><span class=se></span>           easyrsa build-client-full CLIENTNAME nopass
</code></pre></div><ul><li><code>CLIENTNAME</code> should be whatever identifier you want for that profile/device</li><li>remove <code>nopass</code> if you want the profile to have a password (that you will to enter everytime you connect)</li></ul></li><li><p>Generate .ovpn and download link</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run --rm <span class=se>\
</span><span class=se></span>           -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>           fopina/openvpn:helper <span class=se>\
</span><span class=se></span>           ovpn_getclient_link CLIENTNAME
</code></pre></div><p>This will bundle the previous step into an .ovpn file, upload it to <a href=https://vim.cx>vim.cx</a> (which is a <a href=https://privatebin.info/>PrivateBin</a> instance that supports attachments) and generate a QR code to make it easier to copy to a mobile device.
If you prefer to manage the file transfer yourself, you can use:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker run --rm <span class=se>\
</span><span class=se></span>           -v testvpn:/etc/openvpn <span class=se>\
</span><span class=se></span>           fopina/openvpn <span class=se>\
</span><span class=se></span>           ovpn_getclient CLIENTNAME &gt; CLIENTNAME.ovpn
</code></pre></div></li></ol><h2 id=done-references>Done: references<a href=#done-references class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><a href=https://github.com/fopina/privatebin>CLI</a> used to upload attachments to privatebin</li><li><a href=https://github.com/fumiyas/qrc>CLI</a> used to generate the QR codes in the terminal</li><li><a href=https://github.com/fopina/docker-openvpn/blob/master/.github/workflows/main.yml>this github workflow</a> to make the multi-platform builds of the docker image</li></ul><p>Enjoy your home VPN.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://rpg.skmobi.com/tags/vpn>vpn</a></span><span class=tag><a href=https://rpg.skmobi.com/tags/raspberrypi>raspberrypi</a></span><span class=tag><a href=https://rpg.skmobi.com/tags/docker>docker</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>529 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2019-12-15 18:54 +0000</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=https://github.com/fopina/rpg/commit/9a565c20a15b9b81d32dd18a5b2335cadffb0d64 target=_blank rel=noopener>9a565c2</a> @ 2019-12-17</p></footer></article><div class="post-nav thin"><a class=next-post href=https://rpg.skmobi.com/posts/0x8490_privileged_swarm_service/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>0x8490 Privileged Swarm Services</span></a>
<a class=prev-post href=https://rpg.skmobi.com/posts/0xd755_gcp_logging/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>0xD755 Free Log Collection</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"random-post-generator"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://rpg.skmobi.com>Filipe Pina</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://rpg.skmobi.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://rpg.skmobi.com/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-152680315-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>